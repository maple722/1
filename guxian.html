import mido
from mido import Message, MidiFile, MidiTrack
import random

def create_midi(filename):
    midi = MidiFile()
    track = MidiTrack()
    midi.tracks.append(track)
    
    # 设置节奏
    tempo = mido.bpm2tempo(90)  # 90 BPM
    track.append(mido.MetaMessage('set_tempo', tempo=tempo))
    
    # 主旋律音符 (C大调)
    melody_notes = [60, 62, 64, 65, 67, 69, 71, 72]  # C4 - C5
    
    # 创建旋律
    for i in range(16):
        note = random.choice(melody_notes)
        track.append(Message('note_on', note=note, velocity=64, time=0))
        track.append(Message('note_off', note=note, velocity=64, time=480))
    
    # 创建打击乐器轨道
    drum_track = MidiTrack()
    midi.tracks.append(drum_track)
    
    # 选取常见打击乐音符 (MIDI 标准鼓组：36-38, 42, 46, 49)
    drum_notes = [36, 38, 42, 46, 49]
    for i in range(8):
        drum_note = random.choice(drum_notes)
        drum_track.append(Message('note_on', channel=9, note=drum_note, velocity=80, time=0))
        drum_track.append(Message('note_off', channel=9, note=drum_note, velocity=80, time=240))
    
    # 保存 MIDI 文件
    midi.save(filename)
    print(f"MIDI file '{filename}' generated successfully.")

# 生成 MIDI
create_midi('melody_with_drums.mid')
